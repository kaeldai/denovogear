language: cpp
sudo: true
compiler:
    - gcc
cache:
    directories:
    - build
    - build/eigen
    - build/htslib
before_install:
    - sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
    - sudo apt-get update -qq
install:
    - sudo apt-get install -qq gcc-4.8 g++-4.8 
    - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.8 90
before_script:
    - mkdir build/new_cmake
    - mkdir build/htslib
    - mkdir build/boost_install
    - wget -qO- http://www.cmake.org/files/v3.1/cmake-3.1.0-Linux-x86_64.tar.gz | tar xz --strip-components 1 -C build/new_cmake/
    - wget -qO- http://downloads.sourceforge.net/project/boost/boost/1.57.0/boost_1_57_0.tar.bz2 | tar xj -C build/boost_install/
    - cd build/boost_install/boost_1_57_0 && sudo ./bootstrap.sh --with-libraries=program_options,thread,system,boost_filesystem && sudo ./b2 install && cd ../../..
    - wget -qO- https://github.com/samtools/htslib/releases/download/1.2.1/htslib-1.2.1.tar.bz2 | tar xj -C build/htslib/ --strip-components 1
    - cd build/htslib && sudo ./configure && sudo make && sudo make install && cd ../.. 
    - mkdir build/eigen
    - wget -qO- http://bitbucket.org/eigen/eigen/get/3.2.4.tar.bz2 | tar xj -C build/eigen/ --strip-components 1 
    - cd build/eigen && mkdir build_dir && cd build_dir && sudo cmake .. && sudo make install && cd ../../..
    - sudo git clone https://github.com/kaeldai/testdata.git ../testdata
script:
    - cd build
    - ./new_cmake/bin/cmake  ..
    - make
    - sudo make test